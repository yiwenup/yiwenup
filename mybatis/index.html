<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=X-UA-Compatible content="IE=edge, chrome=1"><title>Mybatis - Yiwenup - 持续沉淀</title><meta name=Description content="Yiwenup - 持续沉淀"><meta property="og:url" content="http://www.yiwenup.cloud/mybatis/">
<meta property="og:site_name" content="Yiwenup - 持续沉淀"><meta property="og:title" content="Mybatis"><meta property="og:description" content="一、JDBC 操作数据库 知其然，更要知其所以然。在学习 Mybatis 框架之前，首先需要了解该框架的前世今生。持久层框架出现之前，通常的做法是通过 JDBC 进行数据"><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-07T19:12:32+08:00"><meta property="article:modified_time" content="2024-04-27T20:40:47+08:00"><meta property="article:tag" content="Mybatis"><meta property="article:tag" content="持久层"><meta property="og:image" content="http://www.yiwenup.cloud/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://www.yiwenup.cloud/logo.png"><meta name=twitter:title content="Mybatis"><meta name=twitter:description content="一、JDBC 操作数据库 知其然，更要知其所以然。在学习 Mybatis 框架之前，首先需要了解该框架的前世今生。持久层框架出现之前，通常的做法是通过 JDBC 进行数据"><meta name=application-name content="Yiwenup - 持续沉淀"><meta name=apple-mobile-web-app-title content="Yiwenup - 持续沉淀"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://www.yiwenup.cloud/mybatis/><link rel=prev href=http://www.yiwenup.cloud/mybatisx/><link rel=next href=http://www.yiwenup.cloud/02_ddd%E6%8A%80%E6%9C%AF/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Mybatis","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/www.yiwenup.cloud\/mybatis\/"},"image":["http:\/\/www.yiwenup.cloud\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"Mybatis, 持久层","wordcount":9886,"url":"http:\/\/www.yiwenup.cloud\/mybatis\/","datePublished":"2022-06-07T19:12:32+08:00","dateModified":"2024-04-27T20:40:47+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"http:\/\/www.yiwenup.cloud\/images\/avatar.png","width":320,"height":320}},"author":{"@type":"Person","name":"yiwenup"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Yiwenup - 持续沉淀"><span class=header-title-pre><i class='fas fa-piggy-bank'></i></span> Yiwen Up <span class=header-title-post><i class='fas fa-leaf'></i></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/categories/><i class='fas fa-folder-open'></i> 分类 </a><a class=menu-item href=/tags/><i class='fas fa-tags fa-fw'></i> 标签 </a><a class=menu-item href=/posts/><i class='fas fa-book'></i> 所有文章 </a><a class=menu-item href=/></a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Yiwenup - 持续沉淀"><span class=header-title-pre><i class='fas fa-piggy-bank'></i></span> Yiwen Up <span class=header-title-post><i class='fas fa-leaf'></i></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/categories/ title><i class='fas fa-folder-open'></i>分类</a><a class=menu-item href=/tags/ title><i class='fas fa-tags fa-fw'></i>标签</a><a class=menu-item href=/posts/ title><i class='fas fa-book'></i>所有文章</a><a class=menu-item href=/ title></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Mybatis</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-feather-alt"></i></a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/mybatis/><i class="far fa-folder fa-fw"></i>Mybatis</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-06-07>2022-06-07</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 9886 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 20 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#一jdbc-操作数据库>一、JDBC 操作数据库</a><ul><li><a href=#11-使用-jdbc-示例>1.1 使用 JDBC 示例</a></li><li><a href=#12-使用-jdbc-的缺点>1.2 使用 JDBC 的缺点</a></li><li><a href=#13-改进思路>1.3 改进思路</a></li></ul></li><li><a href=#二自定义持久层框架>二、自定义持久层框架</a></li><li><a href=#三走进-mybatis>三、走进 Mybatis</a></li><li><a href=#四mybatis-入门使用>四、Mybatis 入门使用</a><ul><li><a href=#41-准本工作>4.1 准本工作</a></li><li><a href=#42-入门使用---查询>4.2 入门使用 - 查询</a></li><li><a href=#43-入门使用---新增>4.3 入门使用 - 新增</a></li><li><a href=#44-入门使用---修改>4.4 入门使用 - 修改</a></li><li><a href=#45-入门使用---删除>4.5 入门使用 - 删除</a></li><li><a href=#46-sqlmapconfig-配置解析>4.6 SqlMapConfig 配置解析</a></li><li><a href=#47-staffmapper-配置解析>4.7 StaffMapper 配置解析</a></li><li><a href=#48-主流使用方式>4.8 主流使用方式</a></li></ul></li><li><a href=#五mybatis-复杂映射>五、Mybatis 复杂映射</a><ul><li><a href=#51-准备工作>5.1 准备工作</a></li><li><a href=#52-一对一查询>5.2 一对一查询</a></li><li><a href=#53-一对多查询>5.3 一对多查询</a></li><li><a href=#54-多对多查询>5.4 多对多查询</a></li></ul></li><li><a href=#六mybatis-注解式开发>六、Mybatis 注解式开发</a><ul><li><a href=#61-基本增删改查>6.1 基本增删改查</a></li><li><a href=#62-复杂映射---一对一>6.2 复杂映射 - 一对一</a></li><li><a href=#63-复杂映射---一对多>6.3 复杂映射 - 一对多</a></li><li><a href=#64-复杂映射---多对多>6.4 复杂映射 - 多对多</a></li></ul></li><li><a href=#七mybatis-缓存---一级缓存>七、Mybatis 缓存 - 一级缓存</a><ul><li><a href=#71-实践现象>7.1 实践现象</a></li><li><a href=#72-一级缓存原理>7.2 一级缓存原理</a></li></ul></li><li><a href=#八mybatis-缓存---二级缓存>八、Mybatis 缓存 - 二级缓存</a><ul><li><a href=#81-二级缓存图解>8.1 二级缓存图解</a></li></ul></li><li><a href=#九mybatis-缓存---三级缓存>九、Mybatis 缓存 - 三级缓存</a></li><li><a href=#十mybatis-的插件机制>十、Mybatis 的插件机制</a><ul><li><a href=#101-插件简介>10.1 插件简介</a></li><li><a href=#102-插件使用>10.2 插件使用</a></li><li><a href=#103-插件原理>10.3 插件原理</a></li><li><a href=#104-插件机制的使用场景>10.4 插件机制的使用场景</a></li></ul></li><li><a href=#十一mybatis-架构原理>十一、Mybatis 架构原理</a><ul><li><a href=#111-mybatis-主要构件及相互关系>11.1 Mybatis 主要构件及相互关系</a></li><li><a href=#112-流程解析>11.2 流程解析</a></li></ul></li><li><a href=#十二mybatis-周边>十二、Mybatis 周边</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=一jdbc-操作数据库>一、JDBC 操作数据库</h2><blockquote><p>知其然，更要知其所以然。在学习 Mybatis 框架之前，首先需要了解该框架的前世今生。持久层框架出现之前，通常的做法是通过 JDBC 进行数据库操作。</p></blockquote><h3 id=11-使用-jdbc-示例>1.1 使用 JDBC 示例</h3><ol><li><p>建立测试项目，组织 maven 依赖。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;project</span> <span class=na>xmlns=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;modelVersion&gt;</span>4.0.0<span class=nt>&lt;/modelVersion&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>cloud.yiwenup<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>yiwenup-sample-mybatis<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>1.0-SNAPSHOT<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;project.java.version&gt;</span>1.8<span class=nt>&lt;/project.java.version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;project.charset.encoding&gt;</span>UTF-8<span class=nt>&lt;/project.charset.encoding&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;mysql.version&gt;</span>8.0.28<span class=nt>&lt;/mysql.version&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;maven.plugin.version&gt;</span>3.10.1<span class=nt>&lt;/maven.plugin.version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/properties&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>mysql<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>mysql-connector-java<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>${mysql.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;artifactId&gt;</span>maven-compiler-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;version&gt;</span>${maven.plugin.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;source&gt;</span>${project.java.version}<span class=nt>&lt;/source&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;target&gt;</span>${project.java.version}<span class=nt>&lt;/target&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;testSource&gt;</span>${project.java.version}<span class=nt>&lt;/testSource&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;testTarget&gt;</span>${project.java.version}<span class=nt>&lt;/testTarget&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;encoding&gt;</span>${project.charset.encoding}<span class=nt>&lt;/encoding&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/project&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>使用 JDBC 操作数据库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.jdbc
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-08 09:05:23
</span></span></span><span class=line><span class=cl><span class=cm> * @Description JDBC方式操作数据库
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>JdbcDemo</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Connection</span><span class=w> </span><span class=n>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>preparedStatement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ResultSet</span><span class=w> </span><span class=n>resultSet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// region 加载数据库驱动</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;com.mysql.cj.jdbc.Driver&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// endregion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// region 连接数据源</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DriverManager</span><span class=p>.</span><span class=na>getConnection</span><span class=p>(</span><span class=s>&#34;url&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;password&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// endregion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// region 定义SQL语句</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;select * from staff where staff_id = ?&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// endregion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// region 预编译SQL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>preparedStatement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>connection</span><span class=p>.</span><span class=na>prepareStatement</span><span class=p>(</span><span class=n>sql</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// 设置参数，第一个参数为sql语句中参数的序号(从1开始)，第二个参数为设置的参数值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>preparedStatement</span><span class=p>.</span><span class=na>setString</span><span class=p>(</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=s>&#34;staff1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// endregion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// region 执行SQL，获取数据集</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>resultSet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>preparedStatement</span><span class=p>.</span><span class=na>executeQuery</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// endregion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// region 遍历结果集封装数据模型</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Staff</span><span class=o>&gt;</span><span class=w> </span><span class=n>staffList</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>resultSet</span><span class=p>.</span><span class=na>next</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Staff</span><span class=w> </span><span class=n>staff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Staff</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>staff</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>resultSet</span><span class=p>.</span><span class=na>getInt</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>staff</span><span class=p>.</span><span class=na>setStaffId</span><span class=p>(</span><span class=n>resultSet</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;staff_id&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>staff</span><span class=p>.</span><span class=na>setStaffName</span><span class=p>(</span><span class=n>resultSet</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;staff_name&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>staff</span><span class=p>.</span><span class=na>setDescription</span><span class=p>(</span><span class=n>resultSet</span><span class=p>.</span><span class=na>getString</span><span class=p>(</span><span class=s>&#34;description&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>staffList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>staff</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// endregion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>staffList</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// region 释放资源</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>resultSet</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>resultSet</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>preparedStatement</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>preparedStatement</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>connection</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>connection</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// endregion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kd>class</span> <span class=nc>Staff</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>staffId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>staffName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>description</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 省略 get/set/toString...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=12-使用-jdbc-的缺点>1.2 使用 JDBC 的缺点</h3><ol><li>数据连接频繁创建释放，消耗系统资源，影响性能</li><li>SQL 语句嵌入在实际代码中，包括查询条件也是嵌入在代码中的，硬编码方式不利于扩展，可维护性差</li><li>结果集数据提取之后还需要认为封装对象，操作繁琐</li></ol><h3 id=13-改进思路>1.3 改进思路</h3><ol><li>使用数据库连接池初始化连接资源</li><li>将 SQL 语句从代码中进行抽取，解耦出来，单独放在 XML 中定义</li><li>使用反射技术，将结果集根据属性映射，自动填充到目标模型上</li></ol><h2 id=二自定义持久层框架>二、自定义持久层框架</h2><p>使用组合模式、建造者模式、工厂模式、代理模式实现。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=../images/image-20220608141812919.png data-srcset="../images/image-20220608141812919.png, ../images/image-20220608141812919.png 1.5x, ../images/image-20220608141812919.png 2x" data-sizes=auto alt=../images/image-20220608141812919.png title=image-20220608141812919></p><p>使用层只需要建立全局的配置，添加数据源的连接信息，具体数据层的映射文件路径，之后再独立写各个数据层的映射文件即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- sqlMapperConfig.xml --&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;jdbc&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;driver&#34;</span> <span class=na>value=</span><span class=s>&#34;com.mysql.cj.jdbc.Mysql&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;url&#34;</span> <span class=na>value=</span><span class=s>&#34;url&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;username&#34;</span> <span class=na>value=</span><span class=s>&#34;username&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;password&#34;</span> <span class=na>value=</span><span class=s>&#34;password&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/jdbc&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;mappers&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;mapper</span> <span class=na>resource=</span><span class=s>&#34;userMapper.xml&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;mapper</span> <span class=na>resource=</span><span class=s>&#34;staffMapper.xml&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/mappers&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- staffMapper.xml --&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>namespace=</span><span class=s>&#34;Staff&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectList&#34;</span> <span class=na>paramType=</span><span class=s>&#34;java.lang.String&#34;</span> <span class=na>resType=</span><span class=s>&#34;cloud.yiwenup.sample.entity.Staff&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        select * from staff where staff_name = #{staffName}
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/select&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/mapper&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>框架层会使用<code>dom4j</code>解析以上配置文件，并将解析内容封装到<code>Configuration</code>和<code>MappedStatement</code>中，使用<code>SqlSessionFactory</code>创建<code>SqlSession</code>，<code>SqlSession</code>中定义了<code>CRUD</code>方法，具体的实现将交由<code>Execuor</code>进行数据连接获取，<code>SQL</code>解析以及预编译、执行、结果集反射封装。</p><h2 id=三走进-mybatis>三、走进 Mybatis</h2><p>Mybatis 是一款优秀的半自动化 ORM 框架，它支持定制化 SQL，存储过程以及高级映射。Mybatis 原先是 apache 的一个开源项目 ibatis，之后迁入 Google Code 旗下，在 ibatis 3.x 版本正式更名为 Mybatis。Mybatis 对于开发人员来说，SQL 和 java 代码解耦，功能边界明确，Java 代码专注业务，而 xml 中配置的 SQL 可以专注数据。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=../images/image-20220608145408047.png data-srcset="../images/image-20220608145408047.png, ../images/image-20220608145408047.png 1.5x, ../images/image-20220608145408047.png 2x" data-sizes=auto alt=../images/image-20220608145408047.png title=image-20220608145408047></p><h2 id=四mybatis-入门使用>四、Mybatis 入门使用</h2><h3 id=41-准本工作>4.1 准本工作</h3><ol><li><p>搭建项目，组织 maven 依赖</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;project</span> <span class=na>xmlns=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;modelVersion&gt;</span>4.0.0<span class=nt>&lt;/modelVersion&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>cloud.yiwenup<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>yiwenup-sample-mybatis<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>1.0-SNAPSHOT<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;project.java.version&gt;</span>1.8<span class=nt>&lt;/project.java.version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;project.charset.encoding&gt;</span>UTF-8<span class=nt>&lt;/project.charset.encoding&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;mysql.version&gt;</span>8.0.28<span class=nt>&lt;/mysql.version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;mybatis.version&gt;</span>3.5.9<span class=nt>&lt;/mybatis.version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;junit.version&gt;</span>4.12<span class=nt>&lt;/junit.version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;log4j.version&gt;</span>1.2.12<span class=nt>&lt;/log4j.version&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;maven.plugin.version&gt;</span>3.10.1<span class=nt>&lt;/maven.plugin.version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/properties&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.mybatis<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>mybatis<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>${mybatis.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>mysql<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>mysql-connector-java<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>${mysql.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;scope&gt;</span>runtime<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>junit<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>junit<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>${junit.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>log4j<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>log4j<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>${log4j.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;artifactId&gt;</span>maven-compiler-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;version&gt;</span>${maven.plugin.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;source&gt;</span>${project.java.version}<span class=nt>&lt;/source&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;target&gt;</span>${project.java.version}<span class=nt>&lt;/target&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;testSource&gt;</span>${project.java.version}<span class=nt>&lt;/testSource&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;testTarget&gt;</span>${project.java.version}<span class=nt>&lt;/testTarget&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=nt>&lt;encoding&gt;</span>${project.charset.encoding}<span class=nt>&lt;/encoding&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/project&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>创建测试表结构</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>staff</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>staff</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>bigint</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>staff_id</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>staff_name</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>description</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>staff</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;staff1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;staffname1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;description1&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>staff</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;staff2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;staffname2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;description2&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>建立全局配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE configuration PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;environments</span> <span class=na>default=</span><span class=s>&#34;dev&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;environment</span> <span class=na>id=</span><span class=s>&#34;dev&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;transactionManager</span> <span class=na>type=</span><span class=s>&#34;JDBC&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;dataSource</span> <span class=na>type=</span><span class=s>&#34;POOLED&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;driver&#34;</span> <span class=na>value=</span><span class=s>&#34;com.mysql.cj.jdbc.Driver&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;url&#34;</span> <span class=na>value=</span><span class=s>&#34;url&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;username&#34;</span> <span class=na>value=</span><span class=s>&#34;username&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;password&#34;</span> <span class=na>value=</span><span class=s>&#34;password&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/dataSource&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/environment&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/environments&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;mappers&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;mapper</span> <span class=na>resource=</span><span class=s>&#34;mapper/StaffMapper.xml&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/mappers&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=42-入门使用---查询>4.2 入门使用 - 查询</h3><ol><li><p>建立表对应实体类</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.entity
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-08 14:57:21
</span></span></span><span class=line><span class=cl><span class=cm> * @Description
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Staff</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>staffId</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>staffName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>description</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 省略 get/set 方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>创建映射文件<code>StaffMapper.xml</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE mapper
</span></span></span><span class=line><span class=cl><span class=cp>        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>namespace=</span><span class=s>&#34;staffMapper&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;staff&#34;</span> <span class=na>type=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.Staff&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;id</span> <span class=na>column=</span><span class=s>&#34;id&#34;</span> <span class=na>jdbcType=</span><span class=s>&#34;BIGINT&#34;</span> <span class=na>javaType=</span><span class=s>&#34;java.lang.Integer&#34;</span> <span class=na>property=</span><span class=s>&#34;id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;staff_id&#34;</span> <span class=na>jdbcType=</span><span class=s>&#34;VARCHAR&#34;</span> <span class=na>javaType=</span><span class=s>&#34;java.lang.String&#34;</span> <span class=na>property=</span><span class=s>&#34;staffId&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;staff_name&#34;</span> <span class=na>jdbcType=</span><span class=s>&#34;VARCHAR&#34;</span> <span class=na>javaType=</span><span class=s>&#34;java.lang.String&#34;</span> <span class=na>property=</span><span class=s>&#34;staffName&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;description&#34;</span> <span class=na>jdbcType=</span><span class=s>&#34;VARCHAR&#34;</span> <span class=na>javaType=</span><span class=s>&#34;java.lang.String&#34;</span> <span class=na>property=</span><span class=s>&#34;description&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/resultMap&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;findAll&#34;</span> <span class=na>resultMap=</span><span class=s>&#34;staff&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        select * from staff
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/select&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectByName&#34;</span> <span class=na>parameterType=</span><span class=s>&#34;java.util.Map&#34;</span> <span class=na>resultMap=</span><span class=s>&#34;staff&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        select * from staff where staff_name = #{staffName}
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/select&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/mapper&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试类</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>findAll</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getClassLoader</span><span class=p>().</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&#34;config/SqlMapConfig.xml&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SqlSessionFactory</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SqlSessionFactoryBuilder</span><span class=p>().</span><span class=na>build</span><span class=p>(</span><span class=n>inputStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>SqlSession</span><span class=w> </span><span class=n>sqlSession</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=p>.</span><span class=na>openSession</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Staff</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>selectList</span><span class=p>(</span><span class=s>&#34;staffMapper.findAll&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>list</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>selectByName</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getClassLoader</span><span class=p>().</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&#34;config/SqlMapConfig.xml&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SqlSessionFactory</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SqlSessionFactoryBuilder</span><span class=p>().</span><span class=na>build</span><span class=p>(</span><span class=n>inputStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>SqlSession</span><span class=w> </span><span class=n>sqlSession</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=p>.</span><span class=na>openSession</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;staffName&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;staffname2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Staff</span><span class=w> </span><span class=n>staff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>selectOne</span><span class=p>(</span><span class=s>&#34;staffMapper.selectByName&#34;</span><span class=p>,</span><span class=w> </span><span class=n>map</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>staff</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=43-入门使用---新增>4.3 入门使用 - 新增</h3><ol><li><p>映射文件<code>StaffMapper.xml</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE mapper
</span></span></span><span class=line><span class=cl><span class=cp>        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>namespace=</span><span class=s>&#34;staffMapper&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;insert</span> <span class=na>id=</span><span class=s>&#34;save&#34;</span> <span class=na>parameterType=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.Staff&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        insert into staff (staff_id, staff_name, description)
</span></span><span class=line><span class=cl>        values (#{staffId}, #{staffName}, #{description})
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/insert&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/mapper&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>save</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getClassLoader</span><span class=p>().</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&#34;config/SqlMapConfig.xml&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SqlSessionFactory</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SqlSessionFactoryBuilder</span><span class=p>().</span><span class=na>build</span><span class=p>(</span><span class=n>inputStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>SqlSession</span><span class=w> </span><span class=n>sqlSession</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=p>.</span><span class=na>openSession</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Staff</span><span class=w> </span><span class=n>staff</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Staff</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>staff</span><span class=p>.</span><span class=na>setStaffId</span><span class=p>(</span><span class=s>&#34;staff3&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>staff</span><span class=p>.</span><span class=na>setStaffName</span><span class=p>(</span><span class=s>&#34;staffname3&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>staff</span><span class=p>.</span><span class=na>setDescription</span><span class=p>(</span><span class=s>&#34;desc3&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>affect</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>insert</span><span class=p>(</span><span class=s>&#34;staffMapper.save&#34;</span><span class=p>,</span><span class=w> </span><span class=n>staff</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>affect</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 提交事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>commit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=44-入门使用---修改>4.4 入门使用 - 修改</h3><ol><li><p>映射文件<code>StaffMapper.xml</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE mapper
</span></span></span><span class=line><span class=cl><span class=cp>        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>namespace=</span><span class=s>&#34;staffMapper&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;update</span> <span class=na>id=</span><span class=s>&#34;modify&#34;</span> <span class=na>parameterType=</span><span class=s>&#34;java.util.Map&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        update staff set staff_name = #{staffName}, description = #{description} where id = #{id}
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/update&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/mapper&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>modify</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getClassLoader</span><span class=p>().</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&#34;config/SqlMapConfig.xml&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SqlSessionFactory</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SqlSessionFactoryBuilder</span><span class=p>().</span><span class=na>build</span><span class=p>(</span><span class=n>inputStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>SqlSession</span><span class=w> </span><span class=n>sqlSession</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=p>.</span><span class=na>openSession</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;staffName&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;tobedelaaaaaaa&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;description&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;tobedel&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;4&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>affect</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>update</span><span class=p>(</span><span class=s>&#34;staffMapper.modify&#34;</span><span class=p>,</span><span class=w> </span><span class=n>map</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>affect</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 提交事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>commit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=45-入门使用---删除>4.5 入门使用 - 删除</h3><ol><li><p>映射文件<code>StaffMapper.xml</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE mapper
</span></span></span><span class=line><span class=cl><span class=cp>        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>namespace=</span><span class=s>&#34;staffMapper&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;delete</span> <span class=na>id=</span><span class=s>&#34;deleteById&#34;</span> <span class=na>parameterType=</span><span class=s>&#34;java.lang.Integer&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        delete from staff where id = #{id}
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/delete&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/mapper&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteById</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getClassLoader</span><span class=p>().</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&#34;config/SqlMapConfig.xml&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SqlSessionFactory</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SqlSessionFactoryBuilder</span><span class=p>().</span><span class=na>build</span><span class=p>(</span><span class=n>inputStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>SqlSession</span><span class=w> </span><span class=n>sqlSession</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=p>.</span><span class=na>openSession</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>affect</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>delete</span><span class=p>(</span><span class=s>&#34;staffMapper.deleteById&#34;</span><span class=p>,</span><span class=w> </span><span class=n>4</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>affect</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 提交事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>commit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=46-sqlmapconfig-配置解析>4.6 SqlMapConfig 配置解析</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=../images/image-20220608161056803.png data-srcset="../images/image-20220608161056803.png, ../images/image-20220608161056803.png 1.5x, ../images/image-20220608161056803.png 2x" data-sizes=auto alt=../images/image-20220608161056803.png title=image-20220608161056803></p><p><code>transactionManager</code>有两种类型：</p><ul><li>JDBC：这个配置就是直接使用了JDBC 的提交和回滚设置，它依赖于从数据源得到的连接来管理事务作用域。</li><li>MANAGED：这个配置几乎没做什么。它从来不提交或回滚一个连接，而是让容器来管理事务的整个生 命周期(比如 JEE 应用服务器的上下文)。 默认情况下它会关闭连接，然而一些容器并不希望这样，因 此需要将 closeConnection 属性设置为 false 来阻止它默认的关闭行为。</li></ul><p><code>dataSource</code>有三种类型：</p><ul><li>UNPOOLED：这个数据源的实现只是每次被请求时打开和关闭连接。</li><li>POOLED：这种数据源的实现利用池的概念将 JDBC 连接对象组织起来。</li><li>JNDI:这个数据源的实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配 置数据源，然后放置一个 JNDI 上下文的引用。</li></ul><p><code>mapper</code>标签的使用方式可以有如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- 使用相对于类路径的资源引用 --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>resource=</span><span class=s>&#34;org/mybatis/builder/AuthorMapper.xml&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 使用完全限定资源定位符(URL) --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>url=</span><span class=s>&#34;file:///var/mappers/AuthorMapper.xml&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>class=</span><span class=s>&#34;org.mybatis.builder.AuthorMapper&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;package</span> <span class=na>name=</span><span class=s>&#34;org.mybatis.builder&#34;</span><span class=nt>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=47-staffmapper-配置解析>4.7 StaffMapper 配置解析</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=../images/image-20220608162240209.png data-srcset="../images/image-20220608162240209.png, ../images/image-20220608162240209.png 1.5x, ../images/image-20220608162240209.png 2x" data-sizes=auto alt=../images/image-20220608162240209.png title=image-20220608162240209></p><p>主要说明的是 namespace 和 语句 id 会组成当前语句的唯一标识</p><h3 id=48-主流使用方式>4.8 主流使用方式</h3><blockquote><p>Mybatis 的使用者目前最主流的使用方式是通过代理实现。</p></blockquote><ol><li><p>定义接口</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.dao
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-08 16:27:23
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 代理方式
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>StaffProxyMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 根据姓名查询
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param staffName 姓名
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 员工列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Staff</span><span class=o>&gt;</span><span class=w> </span><span class=nf>selectByName</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>staffName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>定义与接口对应的 mapper</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE mapper
</span></span></span><span class=line><span class=cl><span class=cp>        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>namespace=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.dao.StaffProxyMapper&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;staff&#34;</span> <span class=na>type=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.Staff&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;id</span> <span class=na>column=</span><span class=s>&#34;id&#34;</span> <span class=na>jdbcType=</span><span class=s>&#34;BIGINT&#34;</span> <span class=na>javaType=</span><span class=s>&#34;java.lang.Integer&#34;</span> <span class=na>property=</span><span class=s>&#34;id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;staff_id&#34;</span> <span class=na>jdbcType=</span><span class=s>&#34;VARCHAR&#34;</span> <span class=na>javaType=</span><span class=s>&#34;java.lang.String&#34;</span> <span class=na>property=</span><span class=s>&#34;staffId&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;staff_name&#34;</span> <span class=na>jdbcType=</span><span class=s>&#34;VARCHAR&#34;</span> <span class=na>javaType=</span><span class=s>&#34;java.lang.String&#34;</span> <span class=na>property=</span><span class=s>&#34;staffName&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;description&#34;</span> <span class=na>jdbcType=</span><span class=s>&#34;VARCHAR&#34;</span> <span class=na>javaType=</span><span class=s>&#34;java.lang.String&#34;</span> <span class=na>property=</span><span class=s>&#34;description&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/resultMap&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectByName&#34;</span> <span class=na>parameterType=</span><span class=s>&#34;java.lang.String&#34;</span> <span class=na>resultMap=</span><span class=s>&#34;staff&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        select * from staff where staff_name = #{staffName}
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/select&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/mapper&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>新增的 xml 加入全局配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE configuration PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;environments</span> <span class=na>default=</span><span class=s>&#34;dev&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;environment</span> <span class=na>id=</span><span class=s>&#34;dev&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;transactionManager</span> <span class=na>type=</span><span class=s>&#34;JDBC&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;dataSource</span> <span class=na>type=</span><span class=s>&#34;POOLED&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;driver&#34;</span> <span class=na>value=</span><span class=s>&#34;com.mysql.cj.jdbc.Driver&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;url&#34;</span> <span class=na>value=</span><span class=s>&#34;url&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;username&#34;</span> <span class=na>value=</span><span class=s>&#34;usernmae&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;password&#34;</span> <span class=na>value=</span><span class=s>&#34;password&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/dataSource&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/environment&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/environments&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;mappers&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;mapper</span> <span class=na>resource=</span><span class=s>&#34;mapper/StaffProxyMapper.xml&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/mappers&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>selectByNameProxy</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Resources</span><span class=p>.</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&#34;config/SqlMapConfig.xml&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SqlSessionFactory</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SqlSessionFactoryBuilder</span><span class=p>().</span><span class=na>build</span><span class=p>(</span><span class=n>inputStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>SqlSession</span><span class=w> </span><span class=n>sqlSession</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=p>.</span><span class=na>openSession</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StaffProxyMapper</span><span class=w> </span><span class=n>mapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>getMapper</span><span class=p>(</span><span class=n>StaffProxyMapper</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Staff</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>selectByName</span><span class=p>(</span><span class=s>&#34;staffname2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>list</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=五mybatis-复杂映射>五、Mybatis 复杂映射</h2><blockquote><p>首先需要基于上文的<code>SqlMapConfig.xml</code>，再添加一段配置，可以打印 SQL。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;settings&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;setting</span> <span class=na>name=</span><span class=s>&#34;logImpl&#34;</span> <span class=na>value=</span><span class=s>&#34;STDOUT_LOGGING&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/settings&gt;</span>
</span></span></code></pre></td></tr></table></div></div></blockquote><h3 id=51-准备工作>5.1 准备工作</h3><ol><li><p>执行 SQL 准备环境</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- Table structure for user
</span></span></span><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>username</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>password</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>birthday</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=o>=</span><span class=mi>3</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- Records of user
</span></span></span><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;lucy&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;123&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2019-12-12&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;tom&#39;</span><span class=p>,</span><span class=s1>&#39;123&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2019-12-12&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>orders</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>orders</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>ordertime</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>total</span><span class=o>`</span><span class=w> </span><span class=n>double</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>uid</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>uid</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>uid</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=o>`</span><span class=n>orders_ibfk_1</span><span class=o>`</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>uid</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=o>=</span><span class=mi>4</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- Records of orders
</span></span></span><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>orders</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2019-12-12&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;3000&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>orders</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2019-12-12&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;4000&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>orders</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2019-12-12&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;5000&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- Table structure for sys_role
</span></span></span><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>sys_role</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>sys_role</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>rolename</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>roleDesc</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=o>=</span><span class=mi>3</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- Records of sys_role
</span></span></span><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>sys_role</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;CTO&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;CTO&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>sys_role</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;CEO&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;CEO&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- Table structure for sys_user_role
</span></span></span><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>DROP</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>sys_user_role</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>sys_user_role</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>userid</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>`</span><span class=n>roleid</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>userid</span><span class=o>`</span><span class=p>,</span><span class=o>`</span><span class=n>roleid</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>roleid</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>roleid</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=o>`</span><span class=n>sys_user_role_ibfk_1</span><span class=o>`</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>userid</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=o>`</span><span class=n>sys_user_role_ibfk_2</span><span class=o>`</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>roleid</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=o>`</span><span class=n>sys_role</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1>-- Records of sys_user_role
</span></span></span><span class=line><span class=cl><span class=c1>-- ----------------------------
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>sys_user_role</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>sys_user_role</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>sys_user_role</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>sys_user_role</span><span class=o>`</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;2&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=52-一对一查询>5.2 一对一查询</h3><blockquote><p>一个订单，仅属于一个用户</p></blockquote><ol><li><p>新建<code>Order</code>和<code>User</code>实体</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Order</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Date</span><span class=w> </span><span class=n>ordertime</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>total</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 代表当前订单从属于哪一个客户
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 省略 get/set 方法...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Date</span><span class=w> </span><span class=n>birthday</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 省略 get/set 方法...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>创建接口</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.dao
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-08 17:25:26
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 订单Mapper
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>OrderMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询订单
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 订单列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>创建Mapper</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE mapper
</span></span></span><span class=line><span class=cl><span class=cp>        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>namespace=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.dao.OrderMapper&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;orderMap&#34;</span> <span class=na>type=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.Order&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;id&#34;</span> <span class=na>column=</span><span class=s>&#34;id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;ordertime&#34;</span> <span class=na>column=</span><span class=s>&#34;ordertime&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;total&#34;</span> <span class=na>column=</span><span class=s>&#34;total&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;association</span> <span class=na>property=</span><span class=s>&#34;user&#34;</span> <span class=na>javaType=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.User&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;uid&#34;</span> <span class=na>property=</span><span class=s>&#34;id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;username&#34;</span> <span class=na>property=</span><span class=s>&#34;username&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;password&#34;</span> <span class=na>property=</span><span class=s>&#34;password&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;birthday&#34;</span> <span class=na>property=</span><span class=s>&#34;birthday&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/association&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/resultMap&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;findAll&#34;</span> <span class=na>resultMap=</span><span class=s>&#34;orderMap&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        select * from orders o,user u where o.uid=u.id
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/select&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/mapper&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>one2one</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Resources</span><span class=p>.</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&#34;config/SqlMapConfig.xml&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SqlSessionFactory</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SqlSessionFactoryBuilder</span><span class=p>().</span><span class=na>build</span><span class=p>(</span><span class=n>inputStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>SqlSession</span><span class=w> </span><span class=n>sqlSession</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=p>.</span><span class=na>openSession</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>OrderMapper</span><span class=w> </span><span class=n>mapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>getMapper</span><span class=p>(</span><span class=n>OrderMapper</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>list</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=53-一对多查询>5.3 一对多查询</h3><blockquote><p>一个用户可以有多个订单</p></blockquote><ol><li><p>修改<code>User</code>实体</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.entity
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-08 17:19:52
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 用户对象
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Date</span><span class=w> </span><span class=n>birthday</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 一个用户可以有多个订单
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=n>orderList</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>创建接口</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.dao
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-08 17:41:36
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 用户Mapper
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>UserMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询所有用户
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 用户列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>创建 Mapper</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE mapper
</span></span></span><span class=line><span class=cl><span class=cp>        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>namespace=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.dao.UserMapper&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;userMap&#34;</span> <span class=na>type=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.User&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;id&#34;</span> <span class=na>property=</span><span class=s>&#34;id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;username&#34;</span> <span class=na>property=</span><span class=s>&#34;username&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;password&#34;</span> <span class=na>property=</span><span class=s>&#34;password&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;birthday&#34;</span> <span class=na>property=</span><span class=s>&#34;birthday&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;collection</span> <span class=na>property=</span><span class=s>&#34;orderList&#34;</span> <span class=na>ofType=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.Order&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;oid&#34;</span> <span class=na>property=</span><span class=s>&#34;id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;ordertime&#34;</span> <span class=na>property=</span><span class=s>&#34;ordertime&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;total&#34;</span> <span class=na>property=</span><span class=s>&#34;total&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/collection&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/resultMap&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;findAll&#34;</span> <span class=na>resultMap=</span><span class=s>&#34;userMap&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        select *,o.id oid from user u left join orders o on u.id=o.uid
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/select&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/mapper&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>one2more</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Resources</span><span class=p>.</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&#34;config/SqlMapConfig.xml&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SqlSessionFactory</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SqlSessionFactoryBuilder</span><span class=p>().</span><span class=na>build</span><span class=p>(</span><span class=n>inputStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>SqlSession</span><span class=w> </span><span class=n>sqlSession</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=p>.</span><span class=na>openSession</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserMapper</span><span class=w> </span><span class=n>mapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>getMapper</span><span class=p>(</span><span class=n>UserMapper</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>list</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=54-多对多查询>5.4 多对多查询</h3><blockquote><p>一个用户可以有多个角色，一个角色也可以绑定多个用户</p></blockquote><ol><li><p>创建<code>Role</code>实体类，修改<code>User</code>实体类</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.entity
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-08 17:52:12
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 角色实体
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Role</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>rolename</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 省略 get/set 方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.entity
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-08 17:19:52
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 用户对象
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>username</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>password</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Date</span><span class=w> </span><span class=n>birthday</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 一个用户可以有多个订单
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=n>orderList</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 一个用户可以有多个角色
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Role</span><span class=o>&gt;</span><span class=w> </span><span class=n>roleList</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 省略 get/set 方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>修改 <code>UserMapper</code>接口</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.dao
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-08 17:41:36
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 用户Mapper
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>UserMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询所有用户
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 用户列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询用户与角色
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 用户（带角色）列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAllUserAndRole</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>修改<code>UserMapper.xml</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE mapper
</span></span></span><span class=line><span class=cl><span class=cp>        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;mapper</span> <span class=na>namespace=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.dao.UserMapper&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;userMap&#34;</span> <span class=na>type=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.User&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;id&#34;</span> <span class=na>property=</span><span class=s>&#34;id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;username&#34;</span> <span class=na>property=</span><span class=s>&#34;username&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;password&#34;</span> <span class=na>property=</span><span class=s>&#34;password&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;birthday&#34;</span> <span class=na>property=</span><span class=s>&#34;birthday&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;collection</span> <span class=na>property=</span><span class=s>&#34;orderList&#34;</span> <span class=na>ofType=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.Order&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;oid&#34;</span> <span class=na>property=</span><span class=s>&#34;id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;ordertime&#34;</span> <span class=na>property=</span><span class=s>&#34;ordertime&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;total&#34;</span> <span class=na>property=</span><span class=s>&#34;total&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/collection&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;collection</span> <span class=na>property=</span><span class=s>&#34;roleList&#34;</span> <span class=na>ofType=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.Role&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;rid&#34;</span> <span class=na>property=</span><span class=s>&#34;id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;rolename&#34;</span> <span class=na>property=</span><span class=s>&#34;rolename&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/collection&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/resultMap&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;userRoleMap&#34;</span> <span class=na>type=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.User&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;id&#34;</span> <span class=na>property=</span><span class=s>&#34;id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;username&#34;</span> <span class=na>property=</span><span class=s>&#34;username&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;password&#34;</span> <span class=na>property=</span><span class=s>&#34;password&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;birthday&#34;</span> <span class=na>property=</span><span class=s>&#34;birthday&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;collection</span> <span class=na>property=</span><span class=s>&#34;roleList&#34;</span> <span class=na>ofType=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.entity.Role&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;rid&#34;</span> <span class=na>property=</span><span class=s>&#34;id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;result</span> <span class=na>column=</span><span class=s>&#34;rolename&#34;</span> <span class=na>property=</span><span class=s>&#34;rolename&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/collection&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/resultMap&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;findAll&#34;</span> <span class=na>resultMap=</span><span class=s>&#34;userMap&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        select *,o.id oid from user u left join orders o on u.id=o.uid
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/select&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;findAllUserAndRole&#34;</span> <span class=na>resultMap=</span><span class=s>&#34;userRoleMap&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        select u.*,r.*,r.id rid from user u left join user_role ur on
</span></span><span class=line><span class=cl>            u.id=ur.user_id inner join role r on ur.role_id=r.id
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/select&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/mapper&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>more2more</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Resources</span><span class=p>.</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&#34;config/SqlMapConfig.xml&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SqlSessionFactory</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SqlSessionFactoryBuilder</span><span class=p>().</span><span class=na>build</span><span class=p>(</span><span class=n>inputStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>(</span><span class=n>SqlSession</span><span class=w> </span><span class=n>sqlSession</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=p>.</span><span class=na>openSession</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserMapper</span><span class=w> </span><span class=n>mapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>getMapper</span><span class=p>(</span><span class=n>UserMapper</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>mapper</span><span class=p>.</span><span class=na>findAllUserAndRole</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>list</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>user</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>user</span><span class=p>.</span><span class=na>getUsername</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>user</span><span class=p>.</span><span class=na>getRoleList</span><span class=p>().</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;----------------------------------&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=六mybatis-注解式开发>六、Mybatis 注解式开发</h2><blockquote><p>可以作为了解，但是本人非常不建议使用这种开发模式在实际的开发过程，原因如下：</p><ul><li>只适用于简单的 SQL，对于动态 SQL 写法过于复杂，不利于维护</li><li>SQL 和 Java 代码耦合</li></ul></blockquote><h3 id=61-基本增删改查>6.1 基本增删改查</h3><ol><li><p>新建 DAO 层接口<code>UserAnnoMapper.java</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.dao
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-09 09:01:21
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 注解式开发
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>UserAnnoMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 新增用户
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param user 用户信息
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Insert</span><span class=p>(</span><span class=s>&#34;insert into user (username, password, birthday) values (#{username}, #{password}, #{birthday})&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>add</span><span class=p>(</span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 修改用户信息
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param user 用户信息
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Update</span><span class=p>(</span><span class=s>&#34;update user set username = #{username}, password = #{password} where id = #{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>updateById</span><span class=p>(</span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 根据ID查询用户
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param id ID
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 用户信息
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from user where id = #{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>User</span><span class=w> </span><span class=nf>selectById</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询所有
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 用户列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 删除用户
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param id ID
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Delete</span><span class=p>(</span><span class=s>&#34;delete from user where id = #{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteById</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>注册全局配置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE configuration PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;settings&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;setting</span> <span class=na>name=</span><span class=s>&#34;logImpl&#34;</span> <span class=na>value=</span><span class=s>&#34;STDOUT_LOGGING&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/settings&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;environments</span> <span class=na>default=</span><span class=s>&#34;dev&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;environment</span> <span class=na>id=</span><span class=s>&#34;dev&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;transactionManager</span> <span class=na>type=</span><span class=s>&#34;JDBC&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;dataSource</span> <span class=na>type=</span><span class=s>&#34;POOLED&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;driver&#34;</span> <span class=na>value=</span><span class=s>&#34;com.mysql.cj.jdbc.Driver&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;url&#34;</span> <span class=na>value=</span><span class=s>&#34;jdbc:mysql://124.223.155.114:3306/mybatis_learn?useUnicode=true&amp;amp;useSSL=false&amp;amp;allowPublicKeyRetrieval=true&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;username&#34;</span> <span class=na>value=</span><span class=s>&#34;root&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;password&#34;</span> <span class=na>value=</span><span class=s>&#34;lottery&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/dataSource&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/environment&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/environments&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;mappers&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;mapper</span> <span class=na>class=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.dao.UserAnnoMapper&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/mappers&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-09 09:10:42
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 注解开发测试
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AnnotationTest</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>UserAnnoMapper</span><span class=w> </span><span class=n>userAnnoMapper</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>SqlSession</span><span class=w> </span><span class=n>sqlSession</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Before</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>before</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>InputStream</span><span class=w> </span><span class=n>resourceAsStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Resources</span><span class=p>.</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=s>&#34;config/SqlMapConfig.xml&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>SqlSessionFactory</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SqlSessionFactoryBuilder</span><span class=p>().</span><span class=na>build</span><span class=p>(</span><span class=n>resourceAsStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>sqlSession</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSessionFactory</span><span class=p>.</span><span class=na>openSession</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>userAnnoMapper</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>getMapper</span><span class=p>(</span><span class=n>UserAnnoMapper</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@After</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>after</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>sqlSession</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>sqlSession</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>add</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;张三&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;zhangsan&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setBirthday</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Date</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>userAnnoMapper</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>update</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setUsername</span><span class=p>(</span><span class=s>&#34;李四&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>user</span><span class=p>.</span><span class=na>setPassword</span><span class=p>(</span><span class=s>&#34;lisi&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>userAnnoMapper</span><span class=p>.</span><span class=na>updateById</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>selectById</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userAnnoMapper</span><span class=p>.</span><span class=na>selectById</span><span class=p>(</span><span class=n>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>findAll</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userAnnoMapper</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>users</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteById</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>userAnnoMapper</span><span class=p>.</span><span class=na>deleteById</span><span class=p>(</span><span class=n>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=62-复杂映射---一对一>6.2 复杂映射 - 一对一</h3><ol><li><p>新建接口<code>OrderAnnoMapper.java</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.dao
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-09 09:26:05
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 订单Mapper（注解式）
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>OrderAnnoMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询订单
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 订单列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from orders&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Results</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;ordertime&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;ordertime&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;total&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;total&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;uid&#34;</span><span class=p>,</span><span class=w> </span><span class=n>javaType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>one</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nd>@One</span><span class=p>(</span><span class=n>select</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;cloud.yiwenup.sample.mybatis.dao.UserAnnoMapper.selectById&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.dao
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-09 09:01:21
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 注解式开发
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>UserAnnoMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 根据ID查询用户
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param id ID
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 用户信息
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from user where id = #{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>User</span><span class=w> </span><span class=nf>selectById</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>one2one</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>orderAnnoMapper</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>orders</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=63-复杂映射---一对多>6.3 复杂映射 - 一对多</h3><ol><li><p><code>UserAnnoMapper</code>新增方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.dao
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-09 09:01:21
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 注解式开发
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>UserAnnoMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 根据ID查询用户
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param id ID
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 用户信息
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from user where id = #{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>User</span><span class=w> </span><span class=nf>selectById</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询用户及其订单（一对多）
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 信息列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Results</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;username&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;password&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;password&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;birthday&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;birthday&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;orderList&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>javaType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>List</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>many</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nd>@Many</span><span class=p>(</span><span class=n>select</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;cloud.yiwenup.sample.mybatis.dao.OrderAnnoMapper.selectByUid&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAllUserAndOrder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.dao
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-09 09:26:05
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 订单Mapper（注解式）
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>OrderAnnoMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询订单
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 订单列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from orders&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Results</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;ordertime&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;ordertime&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;total&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;total&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;uid&#34;</span><span class=p>,</span><span class=w> </span><span class=n>javaType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>one</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nd>@One</span><span class=p>(</span><span class=n>select</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;cloud.yiwenup.sample.mybatis.dao.UserAnnoMapper.selectById&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 根据 UID 查询订单列表
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param uid 用户ID
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 订单列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from orders where uid = #{uid}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Order</span><span class=o>&gt;</span><span class=w> </span><span class=nf>selectByUid</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>uid</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>one2more</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userAnnoMapper</span><span class=p>.</span><span class=na>findAllUserAndOrder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>list</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=64-复杂映射---多对多>6.4 复杂映射 - 多对多</h3><ol><li><p><code>UserAnnoMapper</code>新增方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.dao
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-09 09:01:21
</span></span></span><span class=line><span class=cl><span class=cm> * @Description 注解式开发
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>UserAnnoMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 根据ID查询用户
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param id ID
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 用户信息
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from user where id = #{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>User</span><span class=w> </span><span class=nf>selectById</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询用户及其订单（一对多）
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 信息列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Results</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;username&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;password&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;password&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;birthday&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;birthday&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;orderList&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>javaType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>List</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>many</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nd>@Many</span><span class=p>(</span><span class=n>select</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;cloud.yiwenup.sample.mybatis.dao.OrderAnnoMapper.selectByUid&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAllUserAndOrder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询用户与角色（多对多）
</span></span></span><span class=line><span class=cl><span class=cm>     * @return 用户列表
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Results</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;username&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;username&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;password&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;password&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;birthday&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;birthday&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nd>@Result</span><span class=p>(</span><span class=n>property</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;roleList&#34;</span><span class=p>,</span><span class=w> </span><span class=n>column</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>javaType</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>List</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>many</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nd>@Many</span><span class=p>(</span><span class=n>select</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;cloud.yiwenup.sample.mybatis.dao.RoleAnnoMapper.selectByUid&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findAllUserAndRole</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>RoleAnnoMapper</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 查询角色（关联用户）
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * @param uid
</span></span></span><span class=line><span class=cl><span class=cm>     * @return
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Select</span><span class=p>(</span><span class=s>&#34;select * from role r,user_role ur where r.id=ur.role_id and ur.user_id=#{uid}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Role</span><span class=o>&gt;</span><span class=w> </span><span class=nf>selectByUid</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>uid</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>单元测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>more2more</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userAnnoMapper</span><span class=p>.</span><span class=na>findAllUserAndRole</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>list</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h2 id=七mybatis-缓存---一级缓存>七、Mybatis 缓存 - 一级缓存</h2><blockquote><p>一级缓存又叫做查询缓存，作用在<code>SqlSession</code>中，在 Mybatis 中是默认开启的。</p></blockquote><h3 id=71-实践现象>7.1 实践现象</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>users1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userAnnoMapper</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>users1</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;------------------&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>users2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userAnnoMapper</span><span class=p>.</span><span class=na>findAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>users2</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=../images/image-20220609103206430.png data-srcset="../images/image-20220609103206430.png, ../images/image-20220609103206430.png 1.5x, ../images/image-20220609103206430.png 2x" data-sizes=auto alt=../images/image-20220609103206430.png title=image-20220609103206430></p><ul><li>在同一个<code>SqlSession</code>中的两次相同的查询。第一次查询首先会在一级缓存中查询是否执行过当前语句，没有执行过，则访问数据库获取数据，之后将数据缓存。第二次查询会在一级缓存中尝试查询，发现缓存中之前执行过，那么就直接从缓存中获取数据。</li><li>如果两次查询之间存在命令类操作（新增、修改、删除），则该操作会清空缓存，在第二次查询的时候就会走数据库查询。</li><li>清空<code>SqlSession</code>的一级缓存的操作，目的是为了保证缓存数据总是最新的。</li></ul><h3 id=72-一级缓存原理>7.2 一级缓存原理</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=../images/image-20220609110037580.png data-srcset="../images/image-20220609110037580.png, ../images/image-20220609110037580.png 1.5x, ../images/image-20220609110037580.png 2x" data-sizes=auto alt=../images/image-20220609110037580.png title=image-20220609110037580></p><ul><li>首先一级缓存本质上是<code>PerpetualCache</code>中的一个 HashMap，这个类对外提供了操作缓存的方法。</li><li><code>BaseExecutor</code>在执行查询操作的时候，会通过<code>createCacheKey</code>方法根据<code>statementId</code>/<code>offset</code>/<code>limit</code>/<code>sql</code>/<code>parameter</code>封装<code>CacheKey</code>，将以上五个参数放在一个 List 中。</li><li>之后<code>BaseExecutor</code>使用<code>CacheKey</code>执行<code>query</code>方法，该方法中调用<code>PerpetualCache</code>的<code>getObject</code>方法查询缓存中是否存在当前 key，如果存在，则取缓存中的数据结果；如果不存在，则调用<code>queryFromDatabase</code>方法查询数据库，最终再将查询结果放入缓存。</li></ul><h2 id=八mybatis-缓存---二级缓存>八、Mybatis 缓存 - 二级缓存</h2><blockquote><p>二级缓存的作用范围是<code>namespace</code>。它支持多个<code>SqlSeesion</code>，并且即使是两个不同的 Mapper，但是如果它们的<code>namespace</code>一致，那也能共享缓存。</p><p>二级缓存默认不开启，需要在全局配置中声明：<setting name=cacheEnabled value=true> ，此外，还需要在指定的 Mapper 中配置上 <cache></p><p>二级缓存还依赖对应的 pojo 实现 Serializable 接口，这是因为二级缓存的介质可以不止内存，通过扩展<code>Cache</code>接口，还可以将数据缓存在磁盘中，所以需要实现序列化接口。</p></blockquote><h3 id=81-二级缓存图解>8.1 二级缓存图解</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=../images/image-20220609112954157.png data-srcset="../images/image-20220609112954157.png, ../images/image-20220609112954157.png 1.5x, ../images/image-20220609112954157.png 2x" data-sizes=auto alt=../images/image-20220609112954157.png title=image-20220609112954157></p><ul><li>二级缓存默认是全局开启的，使用的时候只需要在具体的 Mapper 处加上<code>&lt;cache/></code></li><li>当第一个<code>SqlSession</code>执行 SQL 的时候，会查询二级缓存中是否有数据，此时还没有的话，会直接访问数据库查询，并将查询的结果数据序列化存储</li><li>此时第二个<code>SqlSession</code>在同一个<code>namespace</code>下执行相同的 SQL 时，会在缓存中检索，如果命中了，则直接将数据取出并返回。<strong>注意：如果第一个 <code>SqlSession</code>还没有<code>close</code>，那么第二次的<code>SqlSession</code>还是会认为当前的缓存是未命中的</strong></li><li>和一级缓存一样，如果两次查询之间存在了命令类操作，那么缓存也是会被清空的</li></ul><h2 id=九mybatis-缓存---三级缓存>九、Mybatis 缓存 - 三级缓存</h2><blockquote><p>不论是一级缓存，还是二级缓存，都是内存级别的缓存，内存级缓存在分布式场景下缺少了访问公共性，每个服务实例仅在自己的内存中维护，一方面导致了数据的冗余，另一方面数据的过于分散增加了一致性维护的成本。</p><p>在分布式场景下通常使用分布式缓存策略统一数据节点缓存，所谓的三级缓存即：实现<code>Cache</code>接口，整合缓存中间件，比较流行的缓存中间件目前是<code>Redis</code>，并且 Mybatis 也官方实现了整合 Redis 的方案。</p></blockquote><p><img class=lazyload src=/svg/loading.min.svg data-src=../images/image-20220610101635522.png data-srcset="../images/image-20220610101635522.png, ../images/image-20220610101635522.png 1.5x, ../images/image-20220610101635522.png 2x" data-sizes=auto alt=../images/image-20220610101635522.png title=image-20220610101635522></p><ul><li>Mybatis 官方实现的三级缓存通过整合 Redis 中间件，实现 Cache 接口</li><li><code>RedisCache</code>通过<code>RedisConfigurationBuilder</code>创建<code>RedisConfig</code>并解析，其中<code>RedisConfig</code>继承了<code>JedisPoolConfig</code>，最终能够使用 Redis 客户端<code>Jedis</code>创建连接池<code>JedisPool</code></li><li>三级缓存操作的过程就是通过调用回调方法<code>RedisCallback#doWithRedis(Jedis jedis)</code>实现的</li></ul><h2 id=十mybatis-的插件机制>十、Mybatis 的插件机制</h2><h3 id=101-插件简介>10.1 插件简介</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=../images/image-20220610102918834.png data-srcset="../images/image-20220610102918834.png, ../images/image-20220610102918834.png 1.5x, ../images/image-20220610102918834.png 2x" data-sizes=auto alt=../images/image-20220610102918834.png title=image-20220610102918834></p><p>Mybatis 通过四大核心组件，对开发者友好提供了易于扩展的插件机制。对 Mybatis 来说插件就是拦截器，用来增强核心对象的功能，增强功能本质上是借助于底层的<strong>动态代理</strong>实现的。</p><ul><li>Executor：执行器。处理<code>update</code>/<code>query</code>/<code>commit</code>/<code>rollback</code>等方法</li><li>StatementHandler：SQL 语法构建器。处理<code>prepare</code>/<code>parameterize</code>/<code>batch</code>/<code>update</code>/<code>query</code>等方法</li><li>ParameterHandler：参数处理器。处理<code>getParameterObject</code>/<code>setParameters</code>等方法</li><li>ResultSetHandler：结果集处理器。处理<code>handleResultSets</code>/<code>handleOutputParameters</code>等方法</li></ul><h3 id=102-插件使用>10.2 插件使用</h3><ol><li><p>实现接口<code>Interceptor</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 文件描述
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @Project yiwenup-sample
</span></span></span><span class=line><span class=cl><span class=cm> * @Package cloud.yiwenup.sample.mybatis.plugin
</span></span></span><span class=line><span class=cl><span class=cm> * @Author yiwenup
</span></span></span><span class=line><span class=cl><span class=cm> * @Date 2022-06-10 10:46:01
</span></span></span><span class=line><span class=cl><span class=cm> * @Description
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Intercepts</span><span class=p>({</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 此处需要配置待拦截的组件信息，method 的方法名称以及 args 参数信息都需要准确，可以参考 StatementHandler 源码配置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@Signature</span><span class=p>(</span><span class=n>type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>StatementHandler</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;prepare&#34;</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>Connection</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>class</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MyPlugin</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Interceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 每次执行到待拦截方法的时候，都会进入增强方法
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>intercept</span><span class=p>(</span><span class=n>Invocation</span><span class=w> </span><span class=n>invocation</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Throwable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;@@@@@@@@@@@@@@@@@@@增强逻辑...&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>invocation</span><span class=p>.</span><span class=na>proceed</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 为拦截器生成一个代理，放入拦截器链中
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>plugin</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>target</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;@@@@@@@@@@@@@@@@@@@将要包装的目标对象:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>target</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Plugin</span><span class=p>.</span><span class=na>wrap</span><span class=p>(</span><span class=n>target</span><span class=p>,</span><span class=w> </span><span class=k>this</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 插件初始化的时候会被首先调用，仅调用一次，方便将外部配置引入
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setProperties</span><span class=p>(</span><span class=n>Properties</span><span class=w> </span><span class=n>properties</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;@@@@@@@@@@@@@@@@@@@插件配置的初始化参数:&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>properties</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>全局配置文件中注册拦截器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;plugin</span> <span class=na>interceptor=</span><span class=s>&#34;cloud.yiwenup.sample.mybatis.plugin.MyPlugin&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;username&#34;</span> <span class=na>value=</span><span class=s>&#34;zhangsan&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugins&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>测试结果</p><p><img class=lazyload src=/svg/loading.min.svg data-src=../images/image-20220610110352704.png data-srcset="../images/image-20220610110352704.png, ../images/image-20220610110352704.png 1.5x, ../images/image-20220610110352704.png 2x" data-sizes=auto alt=../images/image-20220610110352704.png title=image-20220610110352704></p></li></ol><h3 id=103-插件原理>10.3 插件原理</h3><ul><li>插件核心的位置是实现<code>intercept</code>方法，在此处可以定制增强内容，另外的关键点是<code>plugin</code>方法，这个方法中的默认实现是调用了<code>Plugin.wrap(target, intercept)</code></li><li><code>Plugin.wrap(target, intercept)</code>的底层静态实现中，首先会校验插件<code>MyPlugin</code>的类注解，看看是不是声明了<code>@Intercepts</code>/<code>@Signature</code>，组装待拦截信息为一个<code>Map&lt;Class&lt;?>, Set&lt;Method>></code>，其中 Map 的 key 便是四大组件之一，Map 的 value 是其中的方法</li><li>获取到<code>Map&lt;Class&lt;?>, Set&lt;Method>></code>之后，<code>Plugin.wrap(target, intercept)</code>拿出<code>target</code>参数的类信息，判断当前待代理的对象是否是在 <code>Map&lt;Class&lt;?>, Set&lt;Method>></code>中，如果不在，则直接放行</li><li>如果<code>target</code>是在待拦截对象中，那么就使用<code>JDK动态代理</code>为其生成代理对象，最终执行到<code>InvocationHandler#invoke</code>中</li><li>在<code>Plugin#invoke</code>中，首先还是判断当前的方式是否是<code>Map&lt;Class&lt;?>, Set&lt;Method>></code>中的待增强方法，如果是，则执行<code>MyPlugin#intercept</code>，否则进行放行处理</li></ul><h3 id=104-插件机制的使用场景>10.4 插件机制的使用场景</h3><ul><li>PageHelper：分页插件</li><li>tk.mybatis：基于 Mybatis 封装的增强通用 Mapper</li></ul><h2 id=十一mybatis-架构原理>十一、Mybatis 架构原理</h2><p><img class=lazyload src=/svg/loading.min.svg data-src=../images/image-20220610143012243.png data-srcset="../images/image-20220610143012243.png, ../images/image-20220610143012243.png 1.5x, ../images/image-20220610143012243.png 2x" data-sizes=auto alt=../images/image-20220610143012243.png title=image-20220610143012243></p><h3 id=111-mybatis-主要构件及相互关系>11.1 Mybatis 主要构件及相互关系</h3><ul><li>SqlSession：作为MyBatis工作的主要顶层API，表示和数据库交互的会话，完成必要数据库增删改查功能</li><li><strong>Executor</strong>：MyBatis执行器，是MyBatis调度的核心，负责SQL语句的生成和查询缓存的维护</li><li><strong>StatementHandler</strong>：封装了 JDBC Statement 操作，负责对 JDBC statement 的操作，如设置参数、将 Statement 结果集转换成 List集合</li><li><strong>ParameterHandler</strong>：负责对用户传递的参数转换成 JDBC Statement 所需要的参数。主要是参数映射配置、参数映射解析、参数类型解析</li><li><strong>ResultSetHandler</strong>：负责将 JDBC 返回的 ResultSet 结果集对象转换成 List 类型的集合</li><li>TypeHandler：负责 java 数据类型和 jdbc 数据类型之间的映射和转换</li><li>MappedStatement：维护了一条 &lt;select | update | delete | insert> 节点的封装</li><li>SqlSource：负责根据用户传递的 parameterObject，动态地生成 SQL 语句，将信息封装到 BoundSql 对象中，并返回</li><li>BoundSql：表示动态生成的 SQL 语句以及相应的参数信息</li></ul><h3 id=112-流程解析>11.2 流程解析</h3><ol><li>加载配置文件，或者解析注解参数，封装<code>Configuration</code>对象</li><li>使用端调用上层 API，通过<code>SqlSession</code>开启会话发送数据请求</li><li>框架层接收到请求，根据<code>statementId</code>查询<code>MappedStatement</code></li><li>根据<code>MappedStatement</code>对象获取最终要执行的 SQL 和传入的参数</li><li>获取数据库连接，访问数据库，执行 SQL 并拿到执行结果</li><li>根据<code>MappedStatement</code>对象中的结果集映射配置对得到的执行结果进行转换，最终得到处理结果</li><li>释放资源并返回处理结果</li></ol><h2 id=十二mybatis-周边>十二、Mybatis 周边</h2><ul><li>PageHelper</li><li>Mybatis-Plus</li><li>tk.mybatis</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2024-04-27&nbsp;<a class=git-hash href=https://github.com/dillonzq/LoveIt/commit/99b897f06596b795df186c59f21db4d4458feb2c target=_blank title="commit by yiwenup(97035457@qq.com) 99b897f06596b795df186c59f21db4d4458feb2c: Tomcat请求处理流程">
<i class="fas fa-hashtag fa-fw"></i>99b897f</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/mybatis/>Mybatis</a>,&nbsp;<a href=/tags/%E6%8C%81%E4%B9%85%E5%B1%82/>持久层</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/mybatisx/ class=prev rel=prev title=MybatisX结合IDEA代码生成><i class="fas fa-angle-left fa-fw"></i>MybatisX结合IDEA代码生成</a>
<a href=/02_ddd%E6%8A%80%E6%9C%AF/ class=next rel=next title="02_DDD 技术篇">02_DDD 技术篇<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>yiwenup</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/twemoji@13.0.0/dist/twemoji.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:0},comment:{},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},twemoji:!0}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>