---
title: "Java远程断点"
date: 2022-09-29T10:06:25+08:00
categories: ["技巧"]
tags: ["技巧"]
draft: false
code:
  copy: true
toc:
  enable: true
---

## 一、场景引入

在团队进行分布式微服务开发的过程中：

- 若服务的复杂性达到了一定的程度，比如完成一个功能需要几个服务配合才可以进行，此时前后端联调，后端在本地启动服务会带来本地机器的负担且有非关注的服务也需要在本地启动
- 在第一点的基础上，微服务还需要本地启动一套中间件配合服务的正常运行
- 考虑以上两点，大部分团队都会采用`CICD`方式配合联调，后端在开发完成之后通常会提交代码，由流水线进行持续集成与部署，所有团队成员共用一套线上的联调环境
- 远程的服务就造成了调试困难的问题，开发人员只有在分析代码之后，在可疑的位置加入日志打印，之后提交流水线部署，通过日志反应的情况进一步判断问题并调试，会造成开发人数达到一定数量的时候，出现镜像频繁构建，代码频繁提交，而提交的内容多数是添加日志答应，并且在调试之后还不能忘记删除调试答应的日志

诸多不便，造成了效率的低下，为此可以考虑尝试引入**远程断点**

## 二、远程断点

在`Java`生态的`web`开发领域，已经多数采用`Spring Boot`开发了，企业内部通常是通过一些方式（人工或者流水线）将代码编译成`jar`之后进一步包装成一个部署包，这个部署包里面会包含`jar`的启动命令，最终由企业内部的运维平台通过上传的部署包，解析部署信息之后，使用启动命令启动服务。

透过现象看本质，我们需要的是一个启动`jar`的指令：

- 通常的做法是直接启动，但是这种方式是运行在客户端的，当我们关闭会话或者`ctrl+c`便会终止服务

  ```sh
  java -jar xxx.jar
  ```

- 使用`nohup`命令，使服务运行在后台

  ```java
  nohup java -jar xxx.jar &
  ```

  ```sh
  # 使用该命令则可以查询到后台运行的服务
  # 需要停止则使用 kill 即可
  jobs
  ```

- 在前面的基础上，可以添加一些参数，实现远程断点调试功能

  ```sh
  nohup java \
  -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=23333,suspend=n \
  -jar xxx.jar &
  ```
  

## 三、缺点

> 优点就是方便调试，使用体验过后就知道其中的便捷

- 无法多人断点调试，因为只暴露了一个监听端口
- 如果当前调试者在公共方法位置打断点，则会影响其他人的正常测试
